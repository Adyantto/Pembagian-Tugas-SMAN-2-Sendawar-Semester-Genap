<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Rincian Tugas Guru</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:#f1f5f9;
}
.header{
  background:linear-gradient(135deg,#1e3c72,#2a7de1);
  color:#fff;
  padding:32px 16px;
  text-align:center;
}
.header h1{
  margin:0;
  font-size:26px;
}
.header p{
  margin-top:8px;
  font-size:15px;
  opacity:.9;
}
.container{
  max-width:900px;
  margin:-40px auto 40px;
  background:#fff;
  border-radius:18px;
  padding:24px;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
}
.section-title{
  font-size:20px;
  font-weight:600;
  color:#1e3c72;
  margin-bottom:16px;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-bottom:20px;
}
th,td{
  padding:12px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{
  background:#f8fafc;
  color:#1e293b;
}
.total{
  font-weight:bold;
  background:#f0fdf4;
}
.actions{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}
button{
  padding:12px 20px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-size:15px;
}
.back{ background:#64748b; color:#fff; }
.print{ background:#22c55e; color:#fff; }
.print.wali{ background:#0ea5e9; }
.print.projek{ background:#6366f1; }
.print.ekskul{ background:#16a34a; }
.print.piket{ background:#f97316; }
</style>
</head>

<body>

<div class="header">
  <h1 id="namaGuru">Nama Guru</h1>
  <p>Rincian Tugas Semester Genap Tahun Pelajaran 2025 / 2026</p>
</div>

<div class="container">

  <div class="section-title">Tugas Mengajar & Tugas Tambahan</div>

  <table>
    <thead>
      <tr>
        <th>No</th>
        <th>Jenis</th>
        <th>Uraian Tugas</th>
        <th>Kelas</th>
        <th>JP</th>
      </tr>
    </thead>
    <tbody id="tugasBody"></tbody>
    <tfoot>
      <tr class="total">
        <td colspan="4">Total Jam Pelajaran</td>
        <td id="totalJP">0</td>
      </tr>
    </tfoot>
  </table>

  <div class="actions">
    <button class="back" onclick="window.location.href='login.html'">
      Kembali
    </button>

    <button class="print" onclick="cetakSK()">
      Cetak Lampiran SK Utama
    </button>

    <button class="print wali" id="btnWaliKelas" onclick="cetakWaliKelas()">
      Cetak SK Wali Kelas
    </button>

    <button class="print projek" id="btnKoorProjek" onclick="cetakKoorProjek()">
      Cetak SK Koordinator Projek
    </button>

    <button class="print ekskul" id="btnEkskul" onclick="cetakEkskul()">
      Cetak SK Ekstrakurikuler
    </button>

    <!-- ðŸ”¹ TAMBAHAN SAJA: GURU PIKET -->
    <button class="print piket" id="btnPiket" onclick="cetakPiket()">
      Cetak SK Guru Piket
    </button>
  </div>

</div>

<!-- DATABASE -->
<script src="data/username.js"></script>
<script src="data/pembagian-tugas.js"></script>
<script src="data/ekstrakurikuler.js"></script>
<script src="data/guru-piket.js"></script>

<script>
// ================= PARAMETER =================
const params = new URLSearchParams(window.location.search);
const username = params.get("username");

if(!username){
  alert("Username tidak ditemukan");
  window.location.href = "login.html";
}

// ================= DATA GURU =================
const guru = masterGuru.find(g => g.username === username);
document.getElementById("namaGuru").innerText = guru ? guru.nama : "Guru";

// ================= DATA TUGAS =================
const dataTugas = pembagianTugas.filter(t => t.username === username);

const tbody = document.getElementById("tugasBody");
let totalJP = 0;

if(dataTugas.length === 0){
  tbody.innerHTML = `
    <tr>
      <td colspan="5" style="text-align:center;color:#999">
        Data tugas belum tersedia
      </td>
    </tr>
  `;
}else{
  dataTugas.forEach((t,i)=>{
    totalJP += Number(t.jp);
    tbody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${t.jenis}</td>
        <td>${t.uraian}</td>
        <td>${t.kelas || '-'}</td>
        <td>${t.jp}</td>
      </tr>
    `;
  });
}

document.getElementById("totalJP").innerText = totalJP;

// ================= DETEKSI KHUSUS =================

// WALI KELAS
const punyaWaliKelas = dataTugas.some(t =>
  t.jenis === "tambahan" && t.uraian.startsWith("Wali Kelas")
);

// KOORDINATOR PROJEK
const regexProjek = /koor\.?\s*projek|koordinator\s*projek/i;
const punyaKoorProjek = dataTugas.some(t =>
  t.jenis === "tambahan" && regexProjek.test(t.uraian)
);

// EKSTRAKURIKULER
const punyaEkskul = dataEkskul.some(e =>
  e.koordinator === guru.nama ||
  e.anggota.includes(guru.nama)
);

// GURU PIKET (TAMBAHAN SAJA)
const punyaPiket = dataGuruPiket.some(h =>
  h.jadwal.some(j => j.guru.includes(guru.nama))
);

// ================= KONTROL TOMBOL =================
if(!punyaWaliKelas) document.getElementById("btnWaliKelas").style.display="none";
if(!punyaKoorProjek) document.getElementById("btnKoorProjek").style.display="none";
if(!punyaEkskul) document.getElementById("btnEkskul").style.display="none";
if(!punyaPiket) document.getElementById("btnPiket").style.display="none";

// ================= FUNGSI CETAK =================
function cetakSK(){
  window.open("cetak.html?username="+encodeURIComponent(username),"_blank");
}
function cetakWaliKelas(){
  window.open("Wali-kelas.html?username="+encodeURIComponent(username),"_blank");
}
function cetakKoorProjek(){
  window.open("Koor-projek.html?username="+encodeURIComponent(username),"_blank");
}
function cetakEkskul(){
  window.open("cetak-lampiran-ekskul.html?username="+encodeURIComponent(username),"_blank");
}
function cetakPiket(){
  window.open("cetak-piket.html","_blank");
}
</script>

</body>
</html>
